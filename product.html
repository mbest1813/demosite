<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Retail Demo Site - Products</title>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H6N3PSJH6G"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  // Direct all GA4 events to MetaRouterâ€™s custom endpoint
  gtag('config', 'G-H6N3PSJH6G', {
    'transport_url': 'https://api.demo-prod.mr-in.com/v1/custom/event'
  });

  function generateUniqueId() {
    return 'msg_' + Math.random().toString(36).substr(2, 9); // Simple unique ID generator
  }

  function sendEnrichedEvent(eventName, eventType, anonymousId, additionalParams = {}) {
    gtag('event', eventName, {
      'writeKey': 'matt_ga4_test',           // Static value for MetaRouter writeKey
      'messageId': generateUniqueId(),       // Unique ID for each event
      'eventName': eventName,                // Event name
      'type': eventType,                     // Event type (e.g., "page", "track", "identify")
      'anonymousId': anonymousId || generateUniqueId(), // Anonymous ID, unique for each user
      ...additionalParams                    // Any additional event-specific parameters
    });
  }

  // Example of sending a page view event
  sendEnrichedEvent('page_view', 'page', 'user_123456', {
    'eventType': 'page'
  });

  // Adding an 'Add to Cart' event for a button
  document.getElementById('addToCartButton').addEventListener('click', function() {
    sendEnrichedEvent('add_to_cart', 'track', 'user_123456', {
      'eventType': 'track',
      'item_name': 'Sample Product',
      'item_price': 20.00,
      'currency': 'USD',
      'quantity': 1
    });
  });
</script>
</head>
<body>
  <h1>Our Products</h1>
  <nav>
    <a href="index.html">Home</a> |
    <a href="cart.html">View Cart</a>
  </nav>
  <div>
    <h2>Product A - $10.00</h2>
    <button onclick="addToCart('Product A', 10)">Add to Cart</button>
  </div>
  <div>
    <h2>Product B - $20.00</h2>
    <button onclick="addToCart('Product B', 20)">Add to Cart</button>
  </div>

  <script>
    function addToCart(product, price) {
      gtag('event', 'add_to_cart', {
        'item_name': product,
        'price': price,
      });
      alert(product + " added to cart!");
    }
  </script>
</body>
</html>